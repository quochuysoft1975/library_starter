# 2.2.5 Edit & Delete Book Flow

## Feature: Edit & Delete Book
**Actor:** Librarian  
**Dependencies:** 2.1.2 (Login), 2.2.4 (View Book Details)

## Flowchart

```mermaid
flowchart TD
    Start([Librarian views book details]) --> DisplayDetails[Display book information]
    DisplayDetails --> LibrarianAction{Librarian action?}
    
    LibrarianAction -->|Edit| ClickEdit[Click 'Sửa']
    LibrarianAction -->|Delete| ClickDelete[Click 'Xóa']
    
    ClickEdit --> ShowEditForm[Show edit form with current data]
    ShowEditForm --> ModifyData[Librarian modifies information]
    ModifyData --> ValidateEdit{Validate changes}
    
    ValidateEdit -->|Validation failed| ErrorValidation[Show validation errors<br/>Same as Add Book]
    ErrorValidation --> ModifyData
    
    ValidateEdit -->|All valid| SaveChanges[Click 'Lưu']
    SaveChanges --> UpdateDB{Update database}
    
    UpdateDB -->|Success| ShowEditSuccess[Show success message]
    UpdateDB -->|Network Error| ErrorNetwork[Show network error, allow retry]
    ErrorNetwork --> SaveChanges
    
    ShowEditSuccess --> RefreshDetails[Refresh book details view]
    RefreshDetails --> DisplayDetails
    
    ClickDelete --> CheckActive{Book has active borrows?}
    
    CheckActive -->|Yes| ErrorActive[Show error: 'Không thể xóa sách đang có đơn mượn'<br/>Disable delete button]
    ErrorActive --> DisplayDetails
    
    CheckActive -->|No| ShowConfirm[Show confirmation dialog]
    ShowConfirm --> UserConfirm{User confirms?}
    
    UserConfirm -->|No| CancelDelete[Cancel deletion]
    CancelDelete --> DisplayDetails
    
    UserConfirm -->|Yes| DeleteBook[Delete book from database]
    DeleteBook --> DeleteSuccess{Delete successful?}
    
    DeleteSuccess -->|No| ErrorNetwork
    DeleteSuccess -->|Yes| ShowDeleteSuccess[Show success message]
    ShowDeleteSuccess --> RedirectList[Redirect to book list]
    RedirectList --> BookList([Book List])
    
    ModifyData --> CancelEdit[Cancel edit]
    CancelEdit --> DisplayDetails
    
    UpdateDB --> CheckBook{Book still exists?}
    CheckBook -->|No| ErrorNotFound[Show error: 'Sách không tồn tại']
    ErrorNotFound --> RedirectList
    
    style Start fill:#e1f5ff
    style BookList fill:#c8e6c9
    style ShowEditSuccess fill:#c8e6c9
    style ShowDeleteSuccess fill:#c8e6c9
    style ErrorValidation fill:#ffcdd2
    style ErrorActive fill:#ffcdd2
    style ErrorNetwork fill:#ffcdd2
    style ErrorNotFound fill:#ffcdd2
```

## Validation Rules
- Same as Add Book (2.2.2)
- Book must not have active borrows to be deleted

## Error Cases
- Book has active borrows (cannot delete)
- Validation errors (same as Add Book)
- Book not found
- Network error

