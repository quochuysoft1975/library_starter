# 2.7.2 Detailed Reports Flow

## Feature: Detailed Reports
**Actor:** Admin, Librarian  
**Dependencies:** 2.1.2 (Login), 2.7.1 (Dashboard Overview)

## Flowchart

```mermaid
flowchart TD
    Start([User Admin/Librarian logged in]) --> NavigateReports[Navigate to Reports page]
    NavigateReports --> DisplayReports[Display available reports:<br/>- Book Report<br/>- Borrow/Return Report<br/>- Penalty Report<br/>- Lost/Damaged Book Report]
    
    DisplayReports --> SelectReport{Select report type?}
    
    SelectReport -->|Book Report| LoadBookReport[Load Book Report:<br/>- Total books<br/>- Status breakdown<br/>- Borrow count]
    SelectReport -->|Borrow/Return Report| LoadBorrowReport[Load Borrow/Return Report:<br/>- Borrow/return counts<br/>- By day/month/quarter]
    SelectReport -->|Penalty Report| LoadPenaltyReport[Load Penalty Report:<br/>- Total penalty revenue<br/>- Overdue readers]
    SelectReport -->|Lost/Damaged Report| LoadLostReport[Load Lost/Damaged Report:<br/>- List of books needing replacement]
    
    LoadBookReport --> DisplayReport[Display report data]
    LoadBorrowReport --> DisplayReport
    LoadPenaltyReport --> DisplayReport
    LoadLostReport --> DisplayReport
    
    DisplayReport --> UserAction{User action?}
    
    UserAction -->|Filter by Date| SelectDateRange[Select date range:<br/>Day/Week/Month/Quarter/Year]
    UserAction -->|Change Report| ChangeReport[Change report type]
    UserAction -->|Export CSV| ClickExport[Click 'Xuất CSV']
    UserAction -->|Clear Filter| ClearFilter[Clear date filter]
    
    SelectDateRange --> ValidateDate{Validate date range}
    
    ValidateDate -->|Invalid range| ErrorDate[Show error: Invalid date range]
    ErrorDate --> SelectDateRange
    
    ValidateDate -->|Valid| FilterData[Filter report data by date range]
    FilterData --> UpdateReport[Update displayed report]
    UpdateReport --> DisplayReport
    
    ClearFilter --> ResetData[Reset to all data]
    ResetData --> DisplayReport
    
    ChangeReport --> SelectReport
    
    ClickExport --> GenerateCSV[Generate CSV file with report data]
    GenerateCSV --> DownloadCSV[Download CSV to user's device]
    DownloadCSV --> ExportSuccess{Export successful?}
    
    ExportSuccess -->|Yes| ShowExportSuccess[Show export success message]
    ExportSuccess -->|No| ErrorExport[Show error: Export failed, allow retry]
    ErrorExport --> ClickExport
    
    ShowExportSuccess --> DisplayReport
    
    LoadBookReport --> CheckData{Data in date range?}
    LoadBorrowReport --> CheckData
    LoadPenaltyReport --> CheckData
    LoadLostReport --> CheckData
    
    CheckData -->|No| ShowNoData[Show 'Không có dữ liệu trong khoảng thời gian này']
    CheckData -->|Yes| DisplayReport
    
    LoadBookReport --> ErrorNetwork{Network error?}
    LoadBorrowReport --> ErrorNetwork
    LoadPenaltyReport --> ErrorNetwork
    LoadLostReport --> ErrorNetwork
    
    ErrorNetwork -->|Yes| ShowError[Show error message, allow retry]
    ShowError --> SelectReport
    ErrorNetwork -->|No| DisplayReport
    
    style Start fill:#e1f5ff
    style DisplayReport fill:#c8e6c9
    style ShowExportSuccess fill:#c8e6c9
    style ErrorDate fill:#ffcdd2
    style ErrorExport fill:#ffcdd2
    style ShowNoData fill:#fff9c4
    style ShowError fill:#ffcdd2
```

## Available Reports
1. **Book Report:** Total books, status, borrow count
2. **Borrow/Return Report:** Borrow/return counts by day/month/quarter
3. **Penalty Report:** Total penalty revenue, overdue readers
4. **Lost/Damaged Book Report:** List of books needing replacement

## Features
- **Filter by Date Range:** Day, Week, Month, Quarter, Year
- **Export to CSV:** Download report data

## Validation Rules
- Date range: Valid date range (start <= end)
- Date range options: Day, Week, Month, Quarter, Year

## Error Cases
- No data in date range
- Invalid date range
- Export fails
- Network error

