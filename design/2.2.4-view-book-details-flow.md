# 2.2.4 View Book Details Flow

## Feature: View Book Details
**Actor:** All Users (Public, no login required)  
**Dependencies:** 2.2.3 (View Book List)

## Flowchart

```mermaid
flowchart TD
    Start([User clicks on book from list]) --> GetBookID[Get book ID]
    GetBookID --> LoadBook[Load book details from database]
    
    LoadBook --> CheckExists{Book exists?}
    
    CheckExists -->|No| ErrorNotFound[Show error: 'Sách không tồn tại']
    ErrorNotFound --> RedirectList[Redirect to book list]
    RedirectList --> BookList([Book List])
    
    CheckExists -->|Yes| CheckUserRole{User role?}
    
    CheckUserRole -->|Not logged in| DisplayPublic[Display public info:<br/>- Title, Author, ISBN<br/>- Publish Year, Description<br/>- Available Quantity<br/>- Borrowed Quantity]
    
    CheckUserRole -->|Reader| DisplayReader[Display reader info:<br/>- All public info<br/>- 'Mượn sách' button]
    
    CheckUserRole -->|Librarian| DisplayLibrarian[Display librarian info:<br/>- All public info<br/>- Borrow History:<br/>  Reader, Borrow Date, Due Date]
    
    CheckUserRole -->|Admin| DisplayLibrarian
    
    DisplayPublic --> UserActionPublic{User action?}
    DisplayReader --> UserActionReader{User action?}
    DisplayLibrarian --> UserActionLibrarian{User action?}
    
    UserActionPublic -->|Go Back| NavigateBack[Navigate back to book list]
    UserActionPublic -->|Login| LoginPage([Redirect to login])
    
    UserActionReader -->|Go Back| NavigateBack
    UserActionReader -->|Borrow Book| ClickBorrow[Click 'Mượn sách']
    UserActionReader -->|Login| LoginPage
    
    UserActionLibrarian -->|Go Back| NavigateBack
    UserActionLibrarian -->|Edit Book| EditBook([Navigate to edit book])
    UserActionLibrarian -->|Delete Book| DeleteBook([Navigate to delete book])
    
    ClickBorrow --> NavigateBorrow[Navigate to borrow flow]
    NavigateBorrow --> BorrowFlow([Borrow Book Flow - 2.3.1])
    
    NavigateBack --> BookList
    
    LoadBook --> ErrorNetwork{Network error?}
    
    ErrorNetwork -->|Yes| ShowError[Show error message, allow retry]
    ShowError --> LoadBook
    ErrorNetwork -->|No| CheckExists
    
    style Start fill:#e1f5ff
    style BookList fill:#c8e6c9
    style BorrowFlow fill:#c8e6c9
    style EditBook fill:#fff9c4
    style DeleteBook fill:#fff9c4
    style LoginPage fill:#fff9c4
    style ErrorNotFound fill:#ffcdd2
    style ShowError fill:#ffcdd2
```

## Display Information
- **Public:** Title, Author, ISBN, Publish Year, Description, Available Quantity, Borrowed Quantity
- **Librarian/Admin:** All public info + Borrow History (Reader, Borrow Date, Due Date)
- **Reader:** All public info + "Mượn sách" button

## Error Cases
- Book not found
- Network error

## Alternative Flows
- Navigate back to book list
- Navigate to borrow flow (for readers)
- Navigate to edit/delete (for librarians)

