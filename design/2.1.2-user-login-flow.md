# 2.1.2 User Login Flow

## Feature: User Login
**Actor:** Public (Anyone)  
**Dependencies:** 2.1.1 (User Registration)

## Flowchart

```mermaid
flowchart TD
    Start([User visits login page]) --> ShowForm[Display login form]
    ShowForm --> FillForm[User enters:<br/>- Email<br/>- Password]
    FillForm --> Validate{Validate input format}
    
    Validate -->|Invalid Email Format| ErrorEmail[Show error: Invalid email format]
    ErrorEmail --> FillForm
    
    Validate -->|Password < 8 or > 16 chars| ErrorPassword[Show error: Password validation failed]
    ErrorPassword --> FillForm
    
    Validate -->|All valid| SubmitForm[Submit credentials]
    SubmitForm --> CheckEmail{Email exists?}
    
    CheckEmail -->|No| ErrorAuth[Show error: Email or password incorrect]
    ErrorAuth --> FillForm
    
    CheckEmail -->|Yes| CheckPassword{Password correct?}
    
    CheckPassword -->|No| ErrorAuth
    
    CheckPassword -->|Yes| CheckStatus{Account status?}
    
    CheckStatus -->|Pending/Inactive| ErrorStatus[Show error: Account not activated]
    ErrorStatus --> FillForm
    
    CheckStatus -->|Active| CreateSession[Create JWT session<br/>24h expiry]
    CreateSession --> SessionSuccess{Session created?}
    
    SessionSuccess -->|No| ErrorSession[Show error: Session creation failed]
    ErrorSession --> SubmitForm
    
    SessionSuccess -->|Yes| CheckRole{User role?}
    
    CheckRole -->|Reader| RedirectReader[Redirect to Reader Dashboard]
    CheckRole -->|Librarian| RedirectLibrarian[Redirect to Librarian Dashboard]
    CheckRole -->|Admin| RedirectAdmin[Redirect to Admin Dashboard]
    
    RedirectReader --> EndReader([Reader Dashboard])
    RedirectLibrarian --> EndLibrarian([Librarian Dashboard])
    RedirectAdmin --> EndAdmin([Admin Dashboard])
    
    FillForm --> ForgotPassword[Click 'Forgot Password']
    ForgotPassword --> ForgotPage([Redirect to password reset - Future feature])
    
    FillForm --> RegisterLink[Click 'Register']
    RegisterLink --> RegisterPage([Redirect to registration page])
    
    style Start fill:#e1f5ff
    style EndReader fill:#c8e6c9
    style EndLibrarian fill:#c8e6c9
    style EndAdmin fill:#c8e6c9
    style ErrorEmail fill:#ffcdd2
    style ErrorPassword fill:#ffcdd2
    style ErrorAuth fill:#ffcdd2
    style ErrorStatus fill:#ffcdd2
    style ErrorSession fill:#ffcdd2
    style ForgotPage fill:#fff9c4
    style RegisterPage fill:#fff9c4
```

## Validation Rules
- **Email:** Valid email format
- **Password:** Not empty, min 8, max 16 characters

## Error Cases
- Email not found
- Wrong password
- Account inactive/pending
- Session creation fails
- Network error

## Alternative Flows
- Forgot password (future feature)
- Navigate to registration page

