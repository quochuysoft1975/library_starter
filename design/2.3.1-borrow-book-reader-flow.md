# 2.3.1 Borrow Book - Reader Flow

## Feature: Borrow Book - Reader
**Actor:** Reader  
**Dependencies:** 2.1.2 (Login), 2.2.4 (View Book Details)

## Flowchart

```mermaid
flowchart TD
    Start([Reader views book details]) --> ClickBorrow[Click 'Mượn Sách']
    ClickBorrow --> CheckConditions{Check conditions}
    
    CheckConditions -->|Book not available| ErrorNotAvailable[Show error: 'Sách hiện không có sẵn']
    ErrorNotAvailable --> BookDetails([Return to book details])
    
    CheckConditions -->|Exceeded max borrow limit| ErrorMaxLimit[Show error: 'Bạn đã mượn tối đa số sách cho phép']
    ErrorMaxLimit --> BookDetails
    
    CheckConditions -->|Has unpaid penalties| ErrorPenalties[Show error: 'Bạn có khoản phạt chưa thanh toán']
    ErrorPenalties --> BookDetails
    
    CheckConditions -->|All conditions met| ShowBorrowForm[Show borrow form]
    ShowBorrowForm --> SelectDuration[Select borrow duration<br/>Default: 14 days<br/>Max: 30 days]
    SelectDuration --> ValidateDuration{Validate duration}
    
    ValidateDuration -->|Invalid duration| ErrorDuration[Show error: Invalid duration]
    ErrorDuration --> SelectDuration
    
    ValidateDuration -->|Valid| SubmitRequest[Submit borrow request]
    SubmitRequest --> CreateBorrow[Create borrow request<br/>Status: 'Chờ xác nhận']
    CreateBorrow --> SaveDB{Save to database}
    
    SaveDB -->|Success| ShowSuccess[Show success message]
    SaveDB -->|Network Error| ErrorNetwork[Show network error, allow retry]
    ErrorNetwork --> SubmitRequest
    
    ShowSuccess --> RedirectHistory[Redirect to borrow history]
    RedirectHistory --> BorrowHistory([Borrow History Page])
    
    ShowBorrowForm --> Cancel[Cancel]
    Cancel --> BookDetails
    
    SelectDuration --> NavigateList[Want to borrow another book]
    NavigateList --> BookList([Navigate to book list])
    
    style Start fill:#e1f5ff
    style BookDetails fill:#fff9c4
    style BookList fill:#fff9c4
    style BorrowHistory fill:#c8e6c9
    style ShowSuccess fill:#c8e6c9
    style ErrorNotAvailable fill:#ffcdd2
    style ErrorMaxLimit fill:#ffcdd2
    style ErrorPenalties fill:#ffcdd2
    style ErrorDuration fill:#ffcdd2
    style ErrorNetwork fill:#ffcdd2
```

## Conditions
- Book must be available (quantity > 0)
- Reader must not exceed max borrow limit (default 5)
- Reader must have no unpaid penalties

## Validation Rules
- Borrow duration: 1-30 days (default 14)

## Error Cases
- Book not available
- Reader exceeds max borrow limit
- Reader has unpaid penalties
- Invalid borrow duration
- Network error

