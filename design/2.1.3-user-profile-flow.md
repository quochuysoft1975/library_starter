# 2.1.3 User Profile Flow

## Feature: User Profile Management
**Actor:** Reader  
**Dependencies:** 2.1.2 (Login)

## Flowchart

```mermaid
flowchart TD
    Start([Reader logged in]) --> NavigateProfile[Navigate to Profile page]
    NavigateProfile --> LoadProfile[Load user profile data]
    LoadProfile --> DisplayProfile[Display profile:<br/>- Name, Email, Phone, Address<br/>- Join Date<br/>- Borrow Count<br/>- Total Penalties]
    
    DisplayProfile --> UserAction{User action?}
    
    UserAction -->|Update Info| ClickUpdate[Click 'Cập nhật thông tin']
    UserAction -->|Change Password| ClickChangePass[Click 'Đổi mật khẩu']
    UserAction -->|View Only| ViewMode([View mode])
    
    ClickUpdate --> ShowUpdateForm[Show update form:<br/>- Name<br/>- Phone<br/>- Address]
    ShowUpdateForm --> FillUpdateForm[User modifies information]
    FillUpdateForm --> ValidateUpdate{Validate input}
    
    ValidateUpdate -->|Name empty or > 50 chars| ErrorName[Show error: Name validation failed]
    ErrorName --> FillUpdateForm
    
    ValidateUpdate -->|Invalid phone format| ErrorPhone[Show error: Invalid phone format]
    ErrorPhone --> FillUpdateForm
    
    ValidateUpdate -->|Address empty or > 255 chars| ErrorAddress[Show error: Address validation failed]
    ErrorAddress --> FillUpdateForm
    
    ValidateUpdate -->|All valid| SaveUpdate[Save changes]
    SaveUpdate --> UpdateSuccess{Update successful?}
    
    UpdateSuccess -->|No| ErrorNetwork[Show network error, allow retry]
    ErrorNetwork --> SaveUpdate
    
    UpdateSuccess -->|Yes| ShowUpdateSuccess[Show success message]
    ShowUpdateSuccess --> RefreshProfile[Refresh profile display]
    RefreshProfile --> DisplayProfile
    
    ClickChangePass --> ShowPassForm[Show password change form:<br/>- Current Password<br/>- New Password<br/>- Confirm New Password]
    ShowPassForm --> FillPassForm[User enters passwords]
    FillPassForm --> ValidatePass{Validate passwords}
    
    ValidatePass -->|Current password wrong| ErrorCurrentPass[Show error: Current password incorrect]
    ErrorCurrentPass --> FillPassForm
    
    ValidatePass -->|New password < 8 or > 16 chars| ErrorNewPass[Show error: New password validation failed]
    ErrorNewPass --> FillPassForm
    
    ValidatePass -->|Passwords don't match| ErrorMatch[Show error: Passwords don't match]
    ErrorMatch --> FillPassForm
    
    ValidatePass -->|All valid| SavePassword[Update password]
    SavePassword --> PassSuccess{Password updated?}
    
    PassSuccess -->|No| ErrorNetwork
    PassSuccess -->|Yes| ShowPassSuccess[Show success message]
    ShowPassSuccess --> RefreshProfile
    
    FillUpdateForm --> CancelUpdate[Cancel update]
    CancelUpdate --> DisplayProfile
    
    FillPassForm --> CancelPass[Cancel password change]
    CancelPass --> DisplayProfile
    
    DisplayProfile --> Logout[User logs out]
    Logout --> LoginPage([Redirect to login])
    
    style Start fill:#e1f5ff
    style ViewMode fill:#c8e6c9
    style ShowUpdateSuccess fill:#c8e6c9
    style ShowPassSuccess fill:#c8e6c9
    style ErrorName fill:#ffcdd2
    style ErrorPhone fill:#ffcdd2
    style ErrorAddress fill:#ffcdd2
    style ErrorCurrentPass fill:#ffcdd2
    style ErrorNewPass fill:#ffcdd2
    style ErrorMatch fill:#ffcdd2
    style ErrorNetwork fill:#ffcdd2
    style LoginPage fill:#fff9c4
```

## Validation Rules
- **Name:** Not empty, max 50 characters
- **Phone:** Valid phone format
- **Address:** Not empty, max 255 characters
- **Current Password:** Must match existing password
- **New Password:** Min 8, max 16 characters

## Error Cases
- Name validation failed
- Invalid phone format
- Address validation failed
- Current password incorrect
- New password validation failed
- Passwords don't match
- Network error

