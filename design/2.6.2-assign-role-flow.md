# 2.6.2 Assign Role Flow

## Feature: Assign User Role
**Actor:** Admin  
**Dependencies:** 2.1.2 (Login), 2.6.1 (User List)

## Flowchart

```mermaid
flowchart TD
    Start([Admin views user list]) --> ClickAssign[Click 'Gán vai trò' on a user]
    ClickAssign --> ShowDialog[Show role selection dialog]
    ShowDialog --> DisplayRoles[Display available roles:<br/>- Reader<br/>- Librarian<br/>- Admin]
    
    DisplayRoles --> SelectRole[Admin selects new role]
    SelectRole --> ValidateRole{Validate role}
    
    ValidateRole -->|Invalid role| ErrorInvalid[Show error: Invalid role selected]
    ErrorInvalid --> SelectRole
    
    ValidateRole -->|Valid| CheckOwn{Is own account?}
    
    CheckOwn -->|Yes| ErrorOwn[Show error: 'Không thể thay đổi vai trò của chính mình']
    ErrorOwn --> DisplayRoles
    
    CheckOwn -->|No| ShowConfirm[Show confirmation dialog]
    ShowConfirm --> UserConfirm{Admin confirms?}
    
    UserConfirm -->|No| CancelAssign[Cancel role assignment]
    CancelAssign --> UserList([Return to user list])
    
    UserConfirm -->|Yes| UpdateRole[Update user role in database]
    UpdateRole --> SaveRole{Save to database}
    
    SaveRole -->|Success| ShowSuccess[Show success message]
    SaveRole -->|Network Error| ErrorNetwork[Show network error, allow retry]
    ErrorNetwork --> UpdateRole
    
    ShowSuccess --> RefreshList[Refresh user list]
    RefreshList --> UserList
    
    ShowDialog --> CheckUser{User exists?}
    CheckUser -->|No| ErrorNotFound[Show error: 'Người dùng không tồn tại']
    ErrorNotFound --> UserList
    
    style Start fill:#e1f5ff
    style UserList fill:#c8e6c9
    style ShowSuccess fill:#c8e6c9
    style ErrorInvalid fill:#ffcdd2
    style ErrorOwn fill:#ffcdd2
    style ErrorNotFound fill:#ffcdd2
    style ErrorNetwork fill:#ffcdd2
```

## Validation Rules
- Role must be one of: Reader, Librarian, Admin
- Cannot change own role

## Error Cases
- User not found
- Invalid role selected
- Cannot change own role
- Network error

## Role Permissions
- **Reader:** Can borrow books, view personal history
- **Librarian:** Can manage books, confirm borrow/return, track penalties
- **Admin:** Full access, manage accounts, reports, settings

