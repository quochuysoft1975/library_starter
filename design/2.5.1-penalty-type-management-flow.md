# 2.5.1 Penalty Type Management Flow

## Feature: Penalty Type Management
**Actor:** Admin  
**Dependencies:** 2.1.2 (Login)

## Flowchart

```mermaid
flowchart TD
    Start([Admin logged in]) --> NavigatePenalty[Navigate to Penalty Type Management]
    NavigatePenalty --> LoadTypes[Load penalty types from database]
    LoadTypes --> DisplayTable[Display penalty types in editable table]
    
    DisplayTable --> AdminAction{Admin action?}
    
    AdminAction -->|Add Type| ClickAdd[Click 'Thêm mức phạt']
    AdminAction -->|Edit Type| ClickEdit[Edit directly in table]
    AdminAction -->|Delete Type| ClickDelete[Click 'Xóa' button]
    
    ClickAdd --> ShowAddForm[Show add penalty type form]
    ShowAddForm --> EnterInfo[Enter information:<br/>- Name<br/>- Amount<br/>- Effective Date<br/>default: today]
    EnterInfo --> ValidateAdd{Validate input}
    
    ValidateAdd -->|Name empty| ErrorNameEmpty[Show error: Name cannot be empty]
    ErrorNameEmpty --> EnterInfo
    
    ValidateAdd -->|Name > 25 chars| ErrorNameLength[Show error: Name too long]
    ErrorNameLength --> EnterInfo
    
    ValidateAdd -->|Amount <= 0 or not number| ErrorAmount[Show error: Amount must be > 0]
    ErrorAmount --> EnterInfo
    
    ValidateAdd -->|Invalid effective date| ErrorDate[Show error: Invalid date]
    ErrorDate --> EnterInfo
    
    ValidateAdd -->|Name already exists| ErrorExists[Show error: Penalty type already exists]
    ErrorExists --> EnterInfo
    
    ValidateAdd -->|All valid| SaveAdd[Save new penalty type]
    SaveAdd --> AddSuccess{Save successful?}
    
    AddSuccess -->|No| ErrorNetwork[Show network error, allow retry]
    ErrorNetwork --> SaveAdd
    
    AddSuccess -->|Yes| ShowAddSuccess[Show success message]
    ShowAddSuccess --> RefreshList[Refresh penalty type list]
    RefreshList --> DisplayTable
    
    ClickEdit --> EditInTable[Edit penalty type in table cell]
    EditInTable --> ValidateEdit{Validate edited data}
    
    ValidateEdit -->|Invalid| ErrorEdit[Show validation error]
    ErrorEdit --> EditInTable
    
    ValidateEdit -->|Valid| SaveEdit[Save changes]
    SaveEdit --> EditSuccess{Save successful?}
    
    EditSuccess -->|No| ErrorNetwork
    EditSuccess -->|Yes| ShowEditSuccess[Show success message]
    ShowEditSuccess --> RefreshList
    
    ClickDelete --> ShowConfirm[Show confirmation dialog]
    ShowConfirm --> UserConfirm{User confirms?}
    
    UserConfirm -->|No| CancelDelete[Cancel deletion]
    CancelDelete --> DisplayTable
    
    UserConfirm -->|Yes| DeleteType[Delete penalty type]
    DeleteType --> DeleteSuccess{Delete successful?}
    
    DeleteSuccess -->|No| ErrorNetwork
    DeleteSuccess -->|Yes| ShowDeleteSuccess[Show success message]
    ShowDeleteSuccess --> RefreshList
    
    EnterInfo --> CancelAdd[Cancel add]
    CancelAdd --> DisplayTable
    
    EditInTable --> CancelEdit[Cancel edit]
    CancelEdit --> DisplayTable
    
    style Start fill:#e1f5ff
    style DisplayTable fill:#c8e6c9
    style ShowAddSuccess fill:#c8e6c9
    style ShowEditSuccess fill:#c8e6c9
    style ShowDeleteSuccess fill:#c8e6c9
    style ErrorNameEmpty fill:#ffcdd2
    style ErrorNameLength fill:#ffcdd2
    style ErrorAmount fill:#ffcdd2
    style ErrorDate fill:#ffcdd2
    style ErrorExists fill:#ffcdd2
    style ErrorEdit fill:#ffcdd2
    style ErrorNetwork fill:#ffcdd2
```

## Validation Rules
- **Name:** Not empty, max 25 characters
- **Amount:** Must be > 0, numeric
- **Effective Date:** Valid date (default: current date)

## Error Cases
- Penalty type name is empty
- Penalty type name > 25 characters
- Amount <= 0 or not a number
- Invalid effective date
- Penalty type already exists
- Network error

