# 2.6.1 User List Flow

## Feature: User List Management
**Actor:** Admin  
**Dependencies:** 2.1.2 (Login)

## Flowchart

```mermaid
flowchart TD
    Start([Admin logged in]) --> NavigateUsers[Navigate to User Management]
    NavigateUsers --> LoadUsers[Load users from database]
    LoadUsers --> DisplayUsers[Display users:<br/>- Email, Name<br/>- Role: Reader/Librarian/Admin<br/>- Join Date<br/>- Status: Active/Inactive]
    
    DisplayUsers --> AdminAction{Admin action?}
    
    AdminAction -->|Search| EnterSearch[Enter search term<br/>email or name]
    AdminAction -->|Filter| SelectRole[Select role filter]
    AdminAction -->|Activate/Deactivate| ClickStatus[Click 'Kích hoạt' or 'Vô hiệu hóa']
    AdminAction -->|Assign Role| ClickAssign[Click 'Gán vai trò']
    
    EnterSearch --> FilterSearch[Filter users by search term]
    FilterSearch --> UpdateDisplay[Update displayed list]
    UpdateDisplay --> DisplayUsers
    
    EnterSearch --> ClearSearch[Clear search]
    ClearSearch --> ResetUsers[Reset to all users]
    ResetUsers --> DisplayUsers
    
    SelectRole --> FilterRole[Filter users by role]
    FilterRole --> UpdateDisplay
    
    SelectRole --> ClearFilter[Clear filter]
    ClearFilter --> ResetUsers
    
    ClickStatus --> CheckOwn{Own account?}
    
    CheckOwn -->|Yes| ErrorOwn[Show error: 'Không thể vô hiệu hóa tài khoản của chính mình']
    ErrorOwn --> DisplayUsers
    
    CheckOwn -->|No| ShowConfirm[Show confirmation dialog]
    ShowConfirm --> UserConfirm{User confirms?}
    
    UserConfirm -->|No| CancelStatus[Cancel action]
    CancelStatus --> DisplayUsers
    
    UserConfirm -->|Yes| UpdateStatus[Update user status]
    UpdateStatus --> SaveStatus{Save to database}
    
    SaveStatus -->|Success| ShowStatusSuccess[Show success message]
    SaveStatus -->|Network Error| ErrorNetwork[Show network error, allow retry]
    ErrorNetwork --> UpdateStatus
    
    ShowStatusSuccess --> RefreshList[Refresh user list]
    RefreshList --> DisplayUsers
    
    ClickAssign --> NavigateAssign[Navigate to Assign Role flow]
    NavigateAssign --> AssignRole([Assign Role Flow - 2.6.2])
    
    LoadUsers --> CheckUser{User exists?}
    CheckUser -->|No| ErrorNotFound[Show error: 'Người dùng không tồn tại']
    ErrorNotFound --> DisplayUsers
    
    LoadUsers --> ErrorNetwork{Network error?}
    ErrorNetwork -->|Yes| ShowError[Show error message, allow retry]
    ShowError --> LoadUsers
    
    style Start fill:#e1f5ff
    style DisplayUsers fill:#c8e6c9
    style ShowStatusSuccess fill:#c8e6c9
    style AssignRole fill:#fff9c4
    style ErrorOwn fill:#ffcdd2
    style ErrorNotFound fill:#ffcdd2
    style ErrorNetwork fill:#ffcdd2
    style ShowError fill:#ffcdd2
```

## Features
- **Search:** By email or name
- **Filter:** By role (Reader, Librarian, Admin)
- **Activate/Deactivate:** User accounts
- **Assign Role:** Navigate to role assignment flow

## Validation Rules
- Search: Optional, matches email or name
- Role filter: Optional, must be valid role
- Cannot deactivate own account

## Error Cases
- User not found
- Cannot deactivate own account
- Network error

