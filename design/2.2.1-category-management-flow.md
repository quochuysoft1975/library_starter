# 2.2.1 Category Management Flow

## Feature: Book Category Management
**Actor:** Librarian  
**Dependencies:** 2.1.2 (Login)

## Flowchart

```mermaid
flowchart TD
    Start([Librarian logged in]) --> NavigateCategory[Navigate to Category Management]
    NavigateCategory --> LoadCategories[Load categories from database]
    LoadCategories --> DisplayTable[Display categories in editable table]
    
    DisplayTable --> LibrarianAction{Librarian action?}
    
    LibrarianAction -->|Add Category| ClickAdd[Click 'Thêm thể loại sách']
    LibrarianAction -->|Edit Category| ClickEdit[Edit directly in table]
    LibrarianAction -->|Delete Category| ClickDelete[Click 'Xóa' button]
    
    ClickAdd --> ShowAddForm[Show add category form]
    ShowAddForm --> EnterName[Enter category name]
    EnterName --> ValidateAdd{Validate name}
    
    ValidateAdd -->|Name empty| ErrorEmpty[Show error: Name cannot be empty]
    ErrorEmpty --> EnterName
    
    ValidateAdd -->|Name > 50 chars| ErrorLength[Show error: Name too long]
    ErrorLength --> EnterName
    
    ValidateAdd -->|Name already exists| ErrorExists[Show error: Category already exists]
    ErrorExists --> EnterName
    
    ValidateAdd -->|Valid| SaveAdd[Save new category]
    SaveAdd --> AddSuccess{Save successful?}
    
    AddSuccess -->|No| ErrorNetwork[Show network error, allow retry]
    ErrorNetwork --> SaveAdd
    
    AddSuccess -->|Yes| ShowAddSuccess[Show success message]
    ShowAddSuccess --> RefreshList[Refresh category list]
    RefreshList --> DisplayTable
    
    ClickEdit --> EditInTable[Edit name in table cell]
    EditInTable --> ValidateEdit{Validate edited name}
    
    ValidateEdit -->|Invalid| ErrorEdit[Show validation error]
    ErrorEdit --> EditInTable
    
    ValidateEdit -->|Valid| SaveEdit[Save changes]
    SaveEdit --> EditSuccess{Save successful?}
    
    EditSuccess -->|No| ErrorNetwork
    EditSuccess -->|Yes| ShowEditSuccess[Show success message]
    ShowEditSuccess --> RefreshList
    
    ClickDelete --> CheckBooks{Category has books?}
    
    CheckBooks -->|Yes| ErrorHasBooks[Show error: Cannot delete category with books<br/>Disable delete button]
    ErrorHasBooks --> DisplayTable
    
    CheckBooks -->|No| ShowConfirm[Show confirmation dialog]
    ShowConfirm --> UserConfirm{User confirms?}
    
    UserConfirm -->|No| CancelDelete[Cancel deletion]
    CancelDelete --> DisplayTable
    
    UserConfirm -->|Yes| DeleteCategory[Delete category]
    DeleteCategory --> DeleteSuccess{Delete successful?}
    
    DeleteSuccess -->|No| ErrorNetwork
    DeleteSuccess -->|Yes| ShowDeleteSuccess[Show success message]
    ShowDeleteSuccess --> RefreshList
    
    EnterName --> CancelAdd[Cancel add]
    CancelAdd --> DisplayTable
    
    EditInTable --> CancelEdit[Cancel edit]
    CancelEdit --> DisplayTable
    
    style Start fill:#e1f5ff
    style DisplayTable fill:#c8e6c9
    style ShowAddSuccess fill:#c8e6c9
    style ShowEditSuccess fill:#c8e6c9
    style ShowDeleteSuccess fill:#c8e6c9
    style ErrorEmpty fill:#ffcdd2
    style ErrorLength fill:#ffcdd2
    style ErrorExists fill:#ffcdd2
    style ErrorEdit fill:#ffcdd2
    style ErrorHasBooks fill:#ffcdd2
    style ErrorNetwork fill:#ffcdd2
```

## Validation Rules
- **Category Name:** Not empty, max 50 characters, unique

## Error Cases
- Category name is empty
- Category name > 50 characters
- Category name already exists
- Category has books (cannot delete)
- Network error

